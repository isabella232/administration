{% block sw_settings_shipping_detail_advanced_prices %}
    <div class="sw-settings-shipping-detail-advanced-prices">
        {% block sw_settings_shipping_detail_advanced_prices_empty_state %}
            <sw-card class="sw-settings-shipping-detail-advanced-prices__empty-state"
                     v-if="!isLoaded && !shippingMethod.priceRules"
                     :large="true">
                <sw-loader></sw-loader>
            </sw-card>
        {% endblock %}

        {% block sw_settings_shipping_detail_advanced_prices_price_card %}
            <sw-card :title="priceGroup.rule ? priceGroup.rule.name : $tc('sw-settings-shipping.priceRules.cardTitlePriceRule')"
                     v-for="priceGroup in priceRuleGroups"
                     :key="priceGroup.ruleId"
                     class="sw-settings-shipping-detail-advanced-prices__price"
                     :isLoading="isLoading"
                     :large="true"
                     v-else>

                {% block sw_settings_shipping_detail_advanced_prices_price_card_toolbar %}
                    <div class="sw-settings-shipping-detail-advanced-prices__toolbar">

                        {% block sw_settings_shipping_detail_advanced_prices_price_card_rule_selection %}
                            <sw-select id="rule"
                                       :store="ruleStore"
                                       :criteria="ruleFilter"
                                       :value="priceGroup.ruleId"
                                       validation="required"
                                       :placeholder="$tc('sw-settings-shipping.priceRules.placeholderRule')"
                                       @input="onRuleChange($event, priceGroup.ruleId)"
                                       class="sw-settings-shipping-detail-advanced-prices__rule">
                                <template slot="result_items" slot-scope="{ item, index }">
                                    <sw-select-option
                                        :disabled="!!priceRuleGroups[item.id]"
                                        :index="index"
                                        :item="item">
                                        {{ item.name }}
                                    </sw-select-option>
                                </template>
                            </sw-select>
                        {% endblock %}

                        {% block sw_settings_shipping_detail_advanced_prices_price_card_action_delete %}
                            <sw-button @click="onPriceGroupDelete(priceGroup.ruleId)" class="sw-settings-shipping-detail__delete-action">
                                <sw-icon name="small-default-x-line-medium" size="20"></sw-icon>
                                {{ $tc('sw-settings-shipping.priceRules.buttonPriceRuleDelete') }}
                            </sw-button>
                        {% endblock %}

                        {% block sw_settings_shipping_detail_advanced_prices_price_card_action_duplicate %}
                            <sw-button v-if="canAddPriceRule"
                                       @click="onPriceGroupDuplicate(priceGroup)"
                                       :disabled="!priceGroup.ruleId">
                                <sw-icon name="small-copy" size="20"></sw-icon>
                                {{ $tc('sw-settings-shipping.priceRules.buttonPriceRuleDuplicate') }}
                            </sw-button>
                        {% endblock %}

                        {% block sw_settings_shipping_detail_advanced_prices_price_card_action_currency %}
                            <sw-context-button :menuOffsetLeft="0" :disabled="!priceGroup.ruleId">
                                {% block sw_settings_shipping_detail_advanced_prices_price_card_action_currency_button %}
                                    <sw-button slot="button" :disabled="!priceGroup.ruleId">
                                        <sw-icon name="default-basic-plus-circle" size="20"></sw-icon>
                                        {{ $tc('sw-settings-shipping.priceRules.buttonPriceRuleCurrencyAdd') }}
                                    </sw-button>
                                {% endblock %}

                                {% block sw_settings_shipping_detail_advanced_prices_price_card_action_currency_menu %}
                                    <sw-context-menu-item v-for="currency in currencies"
                                                          :key="currency.id"
                                                          :disabled="!!priceGroup.currencies[currency.id] || !priceGroup.ruleId"
                                                          @click="onAddCurrency(priceGroup.ruleId, currency)">
                                        <span slot="icon" class="currency-symbol">{{ currency.symbol }}</span>
                                        {{ currency.name }}
                                        {{ (currency.isDefault) ? $tc('sw-settings-shipping.priceRules.textCurrencyDefault') : '' }}
                                    </sw-context-menu-item>
                                {% endblock %}
                            </sw-context-button>
                        {% endblock %}
                    </div>
                {% endblock %}

                {% block sw_settings_shipping_detail_advanced_prices_field_calculation %}
                    <sw-select name="calculation"
                               :id="createId()"
                               :label="$tc('sw-settings-shipping.detail.labelCalculation')"
                               itemValueKey="value"
                               displayName="label"
                               :store="selectValues"
                               @input="onCalculationChange(priceGroup.calculation, priceGroup.ruleId)"
                               :required="true"
                               :disabled="!priceGroup.ruleId"
                               v-model="priceGroup.calculation">
                    </sw-select>
                {% endblock %}

                {% block sw_settings_shipping_detail_advanced_prices_price_matrix %}
                    <div class="sw-settings-shipping-detail-advanced-prices__prices" v-for="currencyRule in priceGroup.currencies">

                        {% block sw_settings_shipping_detail_advanced_prices_price_matrix_title %}
                            <h3 v-if="currencyRule.currency">
                                {{ $tc('sw-settings-shipping.priceRules.textPriceRuleForCurrency') }}:
                                {{ currencyRule.currency.name }} {{ (currencyRule.currency.isDefault) ?
                                $tc('sw-settings-shipping.priceRules.textCurrencyDefault') : '' }}
                            </h3>
                        {% endblock %}

                        {% block sw_settings_shipping_detail_advanced_prices_price_matrix_grid %}
                            <sw-grid :items="currencyRule.prices" :selectable="false" v-if="isLoaded">
                                <template slot="columns" slot-scope="{ item }">
                                    {% block sw_settings_shipping_detail_advanced_prices_price_matrix_grid_columns %}
                                        {% block sw_settings_shipping_detail_advanced_prices_price_matrix_grid_quantity_start %}
                                            <sw-grid-column flex="1"
                                                            align="stretch"
                                                            :label="calculationStartLabel(item.calculation)">
                                                <sw-field type="number"
                                                          :validation="item.calculation === 1 && item.quantityStart >= 1 || item.calculation !== 1 && item.quantityStart >= 0"
                                                          v-model="item.quantityStart">
                                                </sw-field>
                                            </sw-grid-column>
                                        {% endblock %}

                                        {% block sw_settings_shipping_detail_advanced_prices_price_matrix_grid_quantity_end %}
                                            <sw-grid-column flex="1"
                                                            align="stretch"
                                                            :label="calculationEndLabel(item.calculation)">
                                                <sw-field type="number"
                                                          v-model="item.quantityEnd"
                                                          :validation="!item.quantityEnd || item.quantityEnd > item.quantityStart"
                                                          @change="onQuantityEndChange($event, item, priceGroup)"
                                                          :placeholder="$tc('sw-settings-shipping.priceRules.placeholderQuantityEnd')">
                                                </sw-field>
                                            </sw-grid-column>
                                        {% endblock %}

                                        {% block sw_settings_shipping_detail_advanced_prices_price_matrix_grid_price %}
                                            <sw-grid-column flex="1"
                                                            align="stretch"
                                                            :label="$tc('sw-settings-shipping.priceRules.columnPrice')">
                                                <sw-field type="number"
                                                          v-model="item.price"
                                                          :suffix="currencyRule.currency.symbol"
                                                          validation="required">
                                                </sw-field>
                                            </sw-grid-column>
                                        {% endblock %}

                                        {% block sw_settings_shipping_detail_advanced_prices_price_matrix_grid_actions %}
                                            <sw-grid-column flex="64px" align="center">
                                                {% block sw_settings_shipping_detail_advanced_prices_price_matrix_grid_actions_button %}
                                                    <sw-context-button>
                                                        {% block sw_settings_shipping_detail_advanced_prices_price_matrix_grid_actions_duplicate %}
                                                            <sw-context-menu-item @click="onPriceRuleDuplicate(item)">
                                                                {{ $tc('sw-settings-shipping.priceRules.contextMenuDuplicate') }}
                                                            </sw-context-menu-item>
                                                        {% endblock %}

                                                        {% block sw_settings_shipping_detail_advanced_prices_price_matrix_grid_actions_delete %}
                                                            <sw-context-menu-item variant="danger"
                                                                                  @click="onPriceRuleDelete(item)"
                                                                                  :disabled="currencyRule.currency.isDefault &&
                                                                                             currencyRule.prices.length <= 1 &&
                                                                                             Object.keys(priceGroup.currencies).length > 1">
                                                                {{ $tc('sw-settings-shipping.priceRules.contextMenuDelete') }}
                                                            </sw-context-menu-item>
                                                        {% endblock %}
                                                    </sw-context-button>
                                                {% endblock %}
                                            </sw-grid-column>
                                        {% endblock %}
                                    {% endblock %}
                                </template>
                            </sw-grid>
                        {% endblock %}
                    </div>
                {% endblock %}
            </sw-card>
        {% endblock %}

        {% block sw_settings_shipping_detail_advanced_prices_actions %}
            <div class="sw-settings-shipping-detail-advanced-prices__actions" v-if="!isLoading">
                {% block sw_settings_shipping_detail_advanced_prices_actions_add_button %}
                    <sw-button v-if="canAddPriceRule" @click="onAddNewPriceGroup">
                        {{ $tc('sw-settings-shipping.priceRules.buttonAddAdditionalPriceRule') }}
                    </sw-button>
                {% endblock %}
            </div>
        {% endblock %}
    </div>
{% endblock %}
